<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Insert title here</title>
<link rel="stylesheet" href="../src/engine/cesium/Widgets/widgets.css" />
<link rel="stylesheet" href="../thirdparty/jquery-mobile/jquery.mobile-1.4.5.min.css">
<script src="../thirdparty/jquery-mobile/jquery.min.js"></script>
<script src="../thirdparty/jquery-mobile/jquery.mobile-1.4.5.min.js"></script>
<script type="text/javascript" src="../thirdparty/jquery-mobile/jquery.mobile.nestedlists.js"></script>
<script type="text/javascript"
	src="../thirdparty/jquery-ui/jquery-ui.js"></script>
<script type="text/javascript"
	src="../thirdparty/jquery-toast/jquery.toast.js"></script>
</head>
<body>
	<div data-role="page" class="jqm-demos" data-quicklinks="true">
		<!-- default panel  -->
		<div data-role="panel" id="defaultpanel">
			<h3>Default panel options</h3>
			<p>
				This panel has all the default options: positioned on the left with
				the reveal display mode. The panel markup is <em>before</em> the
				header, content and footer in the source order.
			</p>
			<p>To close, click off the panel, swipe left or right, hit the
				Esc key, or use the button below:</p>
			<a href="#demo-links" data-rel="close"
				class="ui-btn ui-shadow ui-corner-all ui-icon-delete ui-btn-icon-left ui-btn-inline">Close
				panel</a>
		</div>
		<!-- /default panel -->

		<div role="main" class="ui-content jqm-content"
			style="width: 100%; height100 %; margin-top: 0; padding: 0; overflow: hidden;">
			<div id="magoContainer"
				style="position: absolute; width: 100%; height: 100%; margin-top: 0; padding: 0; overflow: hidden;"></div>

			<h3>Main Page</h3>
			<a href="#leftpanel1"
				class="ui-btn ui-shadow ui-corner-all ui-btn-inline ui-mini">Reveal</a>
		</div>

		<!-- leftpanel1  -->
		<div data-role="panel" id="leftpanel1" data-position="left"
			data-display="overlay" data-theme="a">
			<div data-role="content">
				         <ul data-role="listview" >
				         	<li data-role="collapsible" data-inset="false" data_iconps="right">
				        	<li data-role="list-divider">HomePage</li>
				        	<li data-role="list-divider">default
				        		<ul>
				        			<li>주소, 위치, 감섹</li>
				        			<li>기본위치 이동</li>
				        		</ul>
				        	</li>
				        	<li data-role="list-divider">Shortcuts</li>
				        	<li data-role="list-divider">Issues</li>
				        	<li data-role="list-divider">Object</li>
				        	<li data-role="list-divider">Debug</li>
				        </ul>       
			</div>
			<!-- 				<form> -->
			<!-- 					<ul data-role="listview" data-inset="true"> -->
			<!--                         <li class="ui-field-contain"> -->
			<!--                             <label for="name2">Text Input:</label> -->
			<!--                             <input type="text" name="name2" id="name2" value="" data-clear-btn="true"> -->
			<!--                         </li> -->
			<!--                         <li class="ui-field-contain"> -->
			<!--                             <label for="textarea2">Textarea:</label> -->
			<!--                         <textarea cols="40" rows="8" name="textarea2" id="textarea2"></textarea> -->
			<!--                         </li> -->
			<!--                         <li class="ui-field-contain"> -->
			<!--                             <label for="flip2">Flip switch:</label> -->
			<!--                             <select name="flip2" id="flip2" data-role="slider"> -->
			<!--                                 <option value="off">Off</option> -->
			<!--                                 <option value="on">On</option> -->
			<!--                             </select> -->
			<!--                         </li> -->
			<!--                         <li class="ui-field-contain"> -->
			<!--                             <label for="slider2">Slider:</label> -->
			<!--                             <input type="range" name="slider2" id="slider2" value="0" min="0" max="100" data-highlight="true"> -->
			<!--                         </li> -->

			<!--                         <li class="ui-field-contain"> -->
			<!--                             <label for="select-choice-1" class="select">Choose shipping method:</label> -->
			<!--                             <select name="select-choice-1" id="select-choice-1"> -->
			<!--                                 <option value="standard">Standard: 7 day</option> -->
			<!--                                 <option value="rush">Rush: 3 days</option> -->
			<!--                                 <option value="express">Express: next day</option> -->
			<!--                                 <option value="overnight">Overnight</option> -->
			<!--                             </select> -->
			<!--                         </li> -->
			<!--                         <li class="ui-body ui-body-b"> -->
			<!--                             <fieldset class="ui-grid-a"> -->
			<!--                                     <div class="ui-block-a"><button type="submit" class="ui-btn ui-corner-all ui-btn-a">Cancel</button></div> -->
			<!--                                     <div class="ui-block-b"><button type="submit" class="ui-btn ui-corner-all ui-btn-a">Submit</button></div> -->
			<!--                             </fieldset> -->
			<!--                         </li> -->
			<!-- 					</ul> -->
			<!-- 				</form> -->
			<a href="#demo-links" data-rel="close"
				class="ui-btn ui-shadow ui-corner-all ui-btn-a ui-icon-delete ui-btn-icon-left ui-btn-inline">Close
				panel</a>
		</div>
		<!-- /leftpanel1 -->
	</div>
	<script type="text/javascript" src="/src/engine/cesium/Cesium.js"></script>
	<script type="text/javascript" src="/src/mago3d/Code.js"></script>
	<script type="text/javascript" src="/src/mago3d/API.js"></script>
	<script type="text/javascript" src="/src/mago3d/Config.js"></script>
	<script type="text/javascript" src="/src/mago3d/Callback.js"></script>
	<script type="text/javascript" src="/src/mago3d/Constant.js"></script>
	<script type="text/javascript" src="/src/mago3d/Message.js"></script>
	<script type="text/javascript" src="/src/mago3d/ManagerFactory.js"></script>
	<script type="text/javascript" src="/src/mago3d/Atmosphere.js"></script>
	<script type="text/javascript" src="/src/mago3d/GeometryUtil.js"></script>
	<script type="text/javascript" src="/src/mago3d/GeometryModifier.js"></script>
	<script type="text/javascript" src="/src/mago3d/Line.js"></script>
	<script type="text/javascript" src="/src/mago3d/Plane.js"></script>
	<script type="text/javascript" src="/src/mago3d/Point3D.js"></script>
	<script type="text/javascript" src="/src/mago3d/Shader.js"></script>
	<script type="text/javascript" src="/src/mago3d/ShaderSource.js"></script>
	<script type="text/javascript" src="/src/mago3d/ReaderWriter.js"></script>
	<script type="text/javascript" src="/src/mago3d/Renderer.js"></script>
	<script type="text/javascript" src="/src/mago3d/Selection.js"></script>
	<script type="text/javascript" src="/src/mago3d/VBOManager.js"></script>
	<script type="text/javascript" src="/src/mago3d/CesiumManager.js"></script>
	<script type="text/javascript" src="/src/mago3d/PostFxShader.js"></script>
	<script type="text/javascript" src="/src/mago3d/FBO.js"></script>
	<script type="text/javascript" src="/src/mago3d/Geometry.js"></script>
	<script type="text/javascript" src="/src/mago3d/Accessor.js"></script>
	<script type="text/javascript" src="/src/mago3d/NeoTexture.js"></script>
	<script type="text/javascript" src="/src/mago3d/BoundingBox.js"></script>
	<script type="text/javascript" src="/src/mago3d/BlockModels.js"></script>
	<script type="text/javascript"
		src="/src/mago3d/FileRequestControler.js"></script>
	<script type="text/javascript" src="/src/mago3d/ManagerUtils.js"></script>
	<script type="text/javascript" src="/src/mago3d/NeoReferenceModels.js"></script>
	<script type="text/javascript" src="/src/mago3d/OcclusionCullOctree.js"></script>
	<script type="text/javascript" src="/src/mago3d/Octree.js"></script>
	<script type="text/javascript"
		src="/src/mago3d/VisibleObjectsControler.js"></script>
	<script type="text/javascript" src="/src/mago3d/Matrix4.js"></script>
	<script type="text/javascript" src="/src/mago3d/Lego.js"></script>
	<script type="text/javascript" src="/src/mago3d/Camera.js"></script>
	<script type="text/javascript" src="/src/mago3d/GeoLocationData.js"></script>
	<script type="text/javascript" src="/src/mago3d/MagoFacade.js"></script>
	<script type="text/javascript" src="/src/mago3d/Policy.js"></script>
	<script type="text/javascript" src="/src/mago3d/Box.js"></script>
	<script type="text/javascript" src="/src/mago3d/Vertex.js"></script>
	<script type="text/javascript" src="/src/mago3d/Triangle.js"></script>
	<script type="text/javascript" src="/src/mago3d/TriSurface.js"></script>
	<script type="text/javascript" src="/src/mago3d/TriPolyhedron.js"></script>
	<script type="text/javascript" src="/src/mago3d/VertexList.js"></script>
	<script type="text/javascript" src="/src/mago3d/VertexMatrix.js"></script>
	<script type="text/javascript" src="/src/mago3d/Color.js"></script>
	<script type="text/javascript" src="/src/mago3d/Quaternion.js"></script>
	<script type="text/javascript" src="/src/mago3d/domain/ProjectLayer.js"></script>
	<script type="text/javascript" src="/src/mago3d/MetaData.js"></script>
	<script type="text/javascript" src="/src/mago3d/SceneState.js"></script>
	<script type="text/javascript" src="/src/mago3d/SplitValue.js"></script>
	<script type="text/javascript" src="/src/mago3d/Frustum.js"></script>
	<script type="text/javascript" src="/src/mago3d/GeographicCoord.js"></script>
	<script type="text/javascript" src="/src/mago3d/TerranTile.js"></script>
	<script type="text/javascript" src="/src/mago3d/GlobeTile.js"></script>
	<script type="text/javascript" src="/src/mago3d/BoundingSphere.js"></script>
	<script type="text/javascript" src="/src/mago3d/AuxiliarSegment.js"></script>
	<script type="text/javascript" src="/src/mago3d/Sphere.js"></script>
	<script type="text/javascript" src="/src/mago3d/ObjectMarker.js"></script>
	<script type="text/javascript" src="/src/mago3d/Pin.js"></script>
	<script>
		var agent = navigator.userAgent.toLowerCase();
		if (agent.indexOf('chrome') < 0) {
			alert("이 데모 페이지는 대용량 웹 데이터 처리를 위해 Chrome 브라우저에 최적화 되어 있습니다. \n원활한 서비스 이용을 위해 Chrome 브라우저를 이용  하시기 바랍니다.");
		}

		var managerFactory = null;
		var insertIssueFlag = false;
		var objectInfoViewFlag = false;
		var listIssueFlag = false;
		var imagePath = "/images/ko";
		magoStart(null, "magoContainer", null, null);
		/* var timerId = setInterval("startMogoUI()", 1000); */

		// mago3d 시작, 정책 데이터 파일을 로딩
		function magoStart(viewer, renderDivId) {
			$.ajax({
				url : "/sample/policy-cesium.json",
				type : "GET",
				dataType : "json",
				success : function(serverPolicy) {
					loadData(viewer, renderDivId, serverPolicy);
				},
				error : function(e) {
					alert(e.responseText);
				}
			});
		}

		function loadData(viewer, renderDivId, serverPolicy) {
			$.ajax({
				url : "/sample/data.json",
				type : "GET",
				dataType : "json",
				success : function(serverData) {
					managerFactory = new ManagerFactory(viewer, renderDivId,
							serverPolicy, serverData, imagePath);
				},
				error : function(e) {
					alert(e.responseText);
				}
			});
		}

		$(document).ready(function() {
			//$("#recentIssueListContent").show();

			// BoundingBox
			changeBoundingBox(false);
			// Selecting And Moving
			changeMouseMove("0");
		});
		$("#issueMoreImage").click(function() {
			if ($("#recentIssueListContent").css("display") == "none") {
				$("#issueMoreImage").addClass("on");
				$("#apiMoreImage").removeClass("on");
				$("#recentIssueListContent").show();
				$("#apiListContent").hide();
			} else {
				$("#issueMoreImage").removeClass("on");
				$("#recentIssueListContent").hide();
			}
		});
		$("#apiMoreImage").click(function() {
			if ($("#apiListContent").css("display") == "none") {
				$("#apiMoreImage").addClass("on");
				$("#issueMoreImage").removeClass("on");
				$("#apiListContent").show();
				$("#recentIssueListContent").hide();
			} else {
				$("#apiMoreImage").removeClass("on");
				$("#apiListContent").hide();
			}
		});

		function flyTo(longitude, latitude, height, duration) {
			managerFactory.flyTo(longitude, latitude, height, duration);
		}

		// 이슈 등록
		$("#issueEnable").click(function() {
			if (insertIssueFlag) {
				insertIssueFlag = false;
				//$("#issueEnable").val("Issue 등록");
				$("#issueEnable").removeClass("on");
			} else {
				insertIssueFlag = true;
				//$("#issueEnable").val("Issue 등록중");
				$("#issueEnable").addClass("on");
			}
			changeInsertIssueModeAPI(insertIssueFlag);
		});
		// object info 표시
		$("#objectInfoEnable").click(function() {
			if (objectInfoViewFlag) {
				objectInfoViewFlag = false;
				$("#objectInfoEnable").removeClass("on");
				//$("#objectInfoEnableLabel").text("Object 정보 표시");
			} else {
				objectInfoViewFlag = true;
				//$("#objectInfoEnableLabel").text("활성화 상태");
				$("#objectInfoEnable").addClass("on");
			}
			changeObjectInfoViewModeAPI(objectInfoViewFlag);
		});
		// issue list 표시
		$("#issuesEnable").click(function() {
			alert("준비중 입니다.");
			return;
			if (listIssueFlag) {
				listIssueFlag = false;
				$("#issuesEnable").removeClass("on");
				//$("#issuesEnableLabel").text("Issue 목록");
			} else {
				listIssueFlag = true;
				$("#issuesEnable").addClass("on");
				//$("#issuesEnableLabel").text("활성화 상태");
			}
			changeListIssueViewModeAPI(listIssueFlag);
		});

		// issue input layer call back function
		function showInsertIssueLayer(data_name, data_key, latitude, longitude,
				height) {
			if (insertIssueFlag) {
				if ($("#inputIssueLayer").css("display") == "none") {
					$("#inputIssueLayer").show();

					$("#data_key").val(data_name);
					$("#latitude").val(latitude);
					$("#longitude").val(longitude);
					$("#height").val(height);

					console.log("data_name = " + data_name + ", data_key = "
							+ data_key + ", latitude = " + latitude
							+ ", longitude = " + longitude + ", height = "
							+ height);
				}
			}
		}

		$("#inputIssueClose").click(function() {
			$("#inputIssueLayer").hide();
		});

		// object 정보 표시 call back function
		function showSelectedObject(projectId, blockId, objectId, latitude,
				longitude, height, heading, pitch, roll) {
			if (objectInfoViewFlag) {
				$("#move_data_key").val(projectId + "_" + blockId);
				$("#move_latitude").val(latitude);
				$("#move_longitude").val(longitude);
				$("#move_height").val(height);
				$("#move_heading").val(heading);
				$("#move_pitch").val(pitch);
				$("#move_roll").val(roll);

				$.toast({
					heading : 'Click Object Info',
					text : [ 'projectId : ' + projectId,
							'blockId : ' + blockId, 'objectId : ' + objectId,
							'latitude : ' + latitude,
							'longitude : ' + longitude, 'height : ' + height,
							'heading : ' + heading, 'pitch : ' + pitch,
							'roll : ' + roll ],
					//bgColor : 'blue',
					hideAfter : 5000,
					icon : 'info'
				});
			}
		}

		function check() {
			if ($("#data_key").val() == "") {
				alert(JS_MESSAGE["issue.datakey.empty"]);
				$("#data_key").focus();
				return false;
			}
			if ($("#title").val() == "") {
				alert(JS_MESSAGE["issue.title.empty"]);
				$("#title").focus();
				return false;
			}
			/* if ($("#assignee").val() == "") {
				alert(JS_MESSAGE["issue.assignee.empty"]);
				$("#assignee").focus();
				return false;
			}
			if ($("#reporter").val() == "") {
				alert(JS_MESSAGE["issue.reporter.empty"]);
				$("#reporter").focus();
				return false;
			} */
			if ($("#contents").val() == "") {
				alert(JS_MESSAGE["issue.contents.empty"]);
				$("#contents").focus();
				return false;
			}
			if ($("#start_hour").val() > 23) {
				alert(JS_MEESAGE["issue.start_hour.proper"]);
				$("#start_hour").focus();
				return false;
			}
			if ($("#start_minute").val() > 59) {
				alert(JS_MESSAGE["issue.start_minute.proper"]);
				$("#start_minute").focus();
				return false;
			}
		}

		var isInsertIssue = true;
		var randomCount = 0;
		$("#issueInsertButton").click(
				function() {
					var issue_id = new Date().getTime() / 1000;
					var dataKeys = [ "Gwangjin", "Gwangjin", "Guro", "DC",
							"gookjoo" ];
					var latitudes = [ 37.57707, 37.57707, 37.57863, 37.57819,
							37.57819 ];
					var longitudes = [ 126.89035, 126.89035, 126.89148,
							126.89211, 126.89211 ];
					var heights = [ 65, 65, 65, 50, 50 ];

					drawInsertIssueImageAPI(issue_id,
							dataKeys[randomCount % 5],
							latitudes[randomCount % 5],
							longitudes[randomCount % 5],
							heights[randomCount % 5]);

					randomCount++;
					/* if (check() == false) {
						return false;
					}
					if(isInsertIssue) {
						isInsertIssue = false;
						var info = $("#issue").serialize();		
						$.ajax({
							url: "/issue/ajax-insert-issue.do",
							type: "POST",
							data: info,
							cache: false,
							dataType: "json",
							success: function(msg){
								if(msg.result == "success") {
									alert(JS_MESSAGE["insert"]);
								} else {
									alert(JS_MESSAGE[msg.result]);
								}
								
								$("#inputIssueLayer").hide();
								isInsertIssue = true;
								ajaxIssueList();
							},
							error:function(request,status,error){
						        //alert(JS_MESSAGE["ajax.error.message"]);
						        alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
						        isInsertIssue = true;
							}
						});
					} else {
						alert(JS_MESSAGE["button.dobule.click"]);
						return;
					} */
				});

		// Data 검색
		$("#searchData").click(function() {
			if ($.trim($("#search_data_key").val()) === "") {
				alert("Data Key를 입력해 주세요.");
				$("#search_data_key").focus();
				return false;
			}
			searchDataAPI($("#search_data_key").val());
		});
		// boundingBox 표시/비표시
		function changeBoundingBox(isShow) {
			$("input:radio[name='boundingBox']:radio[value='" + isShow + "']")
					.prop("checked", true);
			changeBoundingBoxAPI(isShow);
		}
		// 마우스 클릭 객체 이동 모드 변경
		function changeMouseMove(mouseMoveMode) {
			$(
					"input:radio[name='mouseMoveMode']:radio[value='"
							+ mouseMoveMode + "']").prop("checked", true);
			changeMouseMoveAPI(mouseMoveMode);
		}
		// 변환행렬
		$("#changeLocationAndRotationAPI").click(
				function() {
					if (!changeLocationAndRotationCheck())
						return false;
					changeLocationAndRotationAPI($("#move_data_key").val(), $(
							"#move_latitude").val(),
							$("#move_longitude").val(),
							$("#move_height").val(), $("#move_heading").val(),
							$("#move_pitch").val(), $("#move_roll").val());
				});
		function changeLocationAndRotationCheck() {
			if ($.trim($("#move_data_key").val()) === "") {
				alert("Data Key를 입력해 주세요.");
				$("#move_data_key").focus();
				return false;
			}
			if ($.trim($("#move_latitude").val()) === "") {
				alert("위도를 입력해 주세요.");
				$("#move_latitude").focus();
				return false;
			}
			if ($.trim($("#move_longitude").val()) === "") {
				alert("경도를 입력해 주세요.");
				$("#move_longitude").focus();
				return false;
			}
			if ($.trim($("#move_height").val()) === "") {
				alert("높이를 입력해 주세요.");
				$("#move_height").focus();
				return false;
			}
			if ($.trim($("#move_heading").val()) === "") {
				alert("heading을 입력해 주세요.");
				$("#move_heading").focus();
				return false;
			}
			if ($.trim($("#move_pitch").val()) === "") {
				alert("pitch를 입력해 주세요.");
				$("#move_pitch").focus();
				return false;
			}
			if ($.trim($("#move_roll").val()) === "") {
				alert("roll를 입력해 주세요.");
				$("#move_roll").focus();
				return false;
			}
			return true;
		}

		// TODO issue url 밑에 있어야 할지도 모르겠다.
		function ajaxIssueList() {
			var info = "";
			$
					.ajax({
						url : "/homepage/ajax-list-issue.do",
						type : "GET",
						data : info,
						dataType : "json",
						success : function(msg) {
							if (msg.result == "success") {
								var issueList = msg.issueList;
								var content = "";

								if (issueList == null || issueList.length == 0) {
									content += "<div style=\"text-align: center; padding-top:20px; height: 50px;\">"
											+ "	Issue가 존재하지 않습니다." + "</div>";
								} else {
									for (i = 0; i < issueList.length; i++) {
										var issue = null;
										issue = issueList[i];
										content = content
												+ "<div style=\"padding-left: 20px; padding-top: 20px; padding-bottom: 20px; background: gainsboro\">"
												+ "	<div>"
												+ "		<img src=\"/images/${lang }/homepage/bullet_h4.png\" alt=\"\" />"
												+ "		<span style=\"padding-left: 10px; width:200px; overflow: hidden;\">"
												+ issue.title
												+ "</span>"
												+ "		<span style=\"float:right; padding-right: 15px; padding-top: 5px;\">"
												+ "			<a href=\"#\" onclick=\"flyTo('"
												+ issue.longitude
												+ "', '"
												+ issue.latitude
												+ "', '"
												+ issue.height
												+ "', '2')\">"
												+ "				<img src=\"/images/${lang }/homepage/btn_going.png\" width=\"26\" height=\"26\" alt=\"\" />"
												+ "			</a>"
												+ "		</span>"
												+ "	</div>"
												+ "	<div id=\"issue_toggle_" + issue.issue_id + "\">"
												+ "		<span style=\"padding-left: 25px;\">["
												+ issue.issue_type
												+ "]["
												+ issue.priority
												+ "]</span>"
												+ "		<span style=\"padding-left: 5px;\">"
												+ issue.data_group_name
												+ "</span>"
												+ "		<span style=\"float:right; padding-right: 20px;\">"
												+ issue.insert_date.substring(
														0, 19) + "</span>"
												+ "	</div>" + "</div>";
									}
								}
								$("#recentIssueListContent").empty();
								$("#recentIssueListContent").html(content);
							} else {
								alert(JS_MESSAGE[msg.result]);
							}
						},
						error : function(request, status, error) {
							//alert(JS_MESSAGE["ajax.error.message"]);
							console.log("code:" + request.status + "\n"
									+ "message:" + request.responseText + "\n"
									+ "error:" + error);
						}
					});
		}
	</script>
</body>
</html>